<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progresívne technológie - LMS systém</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .header h1 {
            color: #2196F3;
            font-size: 2rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .role-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .role-teacher {
            background: #4CAF50;
            color: white;
        }
        
        .role-student {
            background: #2196F3;
            color: white;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: #2196F3;
            color: white;
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-secondary {
            background: #757575;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .auth-section {
            background: white;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 50px auto;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 5px;
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .auth-tab.active {
            background: #2196F3;
            color: white;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .dashboard {
            display: none;
        }
        
        .dashboard.active {
            display: block;
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h3 {
            color: #2196F3;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }
        
        .games-list {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .games-list h3 {
            color: #2196F3;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .game-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .game-item:hover {
            border-color: #2196F3;
            background: #f8f9fa;
        }
        
        .game-info h4 {
            color: #333;
            margin-bottom: 5px;
        }
        
        .game-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .results-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .results-table h3 {
            color: #2196F3;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .score-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .score-excellent {
            background: #4CAF50;
            color: white;
        }
        
        .score-good {
            background: #FF9800;
            color: white;
        }
        
        .score-poor {
            background: #f44336;
            color: white;
        }
        
        .hidden {
            display: none;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }
        
        .filter-group select, .filter-group input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        /* Game Modal Styles */
        .game-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .game-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 95%;
            max-height: 95%;
            overflow-y: auto;
            width: 800px;
        }
        
        .game-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .close-btn {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* Quiz Styles */
        .question {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #2196F3;
        }
        
        .question h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .options {
            display: grid;
            gap: 15px;
        }
        
        .option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option:hover {
            border-color: #2196F3;
            background: #f0f8ff;
        }
        
        .option.selected {
            border-color: #2196F3;
            background: #e3f2fd;
        }
        
        .option.correct {
            border-color: #4caf50;
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .option.incorrect {
            border-color: #f44336;
            background: #ffebee;
            color: #c62828;
        }
        
        .check-btn, .next-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .check-btn:hover, .next-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .game-score {
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
        }
        
        /* Memory Game Styles */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
            text-align: center;
            padding: 10px;
        }
        
        .memory-card:hover {
            transform: scale(1.05);
        }
        
        .memory-card.flipped {
            background: white;
            color: #333;
            border: 2px solid #2196F3;
        }
        
        .memory-card.matched {
            background: #4caf50;
            color: white;
        }
        
        .memory-stats {
            text-align: center;
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }
        
        .memory-stats div {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* Classification Game Styles */
        .classification-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        
        .items-pool {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            min-height: 300px;
        }
        
        .items-pool h3 {
            color: #2196F3;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .drop-zone {
            background: #fff;
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 20px;
            min-height: 150px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .drop-zone.drag-over {
            border-color: #2196F3;
            background: #f0f8ff;
        }
        
        .drop-zone h4 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .draggable-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            margin: 8px;
            border-radius: 25px;
            cursor: grab;
            display: inline-block;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .draggable-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .draggable-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        
        .restart-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .restart-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }
        
        .explanation {
            background: #e8f5e8;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border-left: 5px solid #4caf50;
        }
        
        .explanation h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .user-info {
                justify-content: center;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .classification-container {
                grid-template-columns: 1fr;
            }
            
            .memory-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .game-modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Authentication Section -->
        <div id="auth-section" class="auth-section">
            <h2>Prihlásenie do systému</h2>
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Prihlásenie</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Registrácia</button>
            </div>
            
            <div id="login-form">
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Heslo:</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Prihlásiť sa</button>
                </form>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 0.9rem;">
                    <strong>Demo účty:</strong><br>
                    Učiteľ: teacher@vste.sk / heslo123<br>
                    Študent: student@vste.sk / heslo123
                </div>
            </div>
            
            <div id="register-form" class="hidden">
                <form onsubmit="register(event)">
                    <div class="form-group">
                        <label for="reg-name">Meno a priezvisko:</label>
                        <input type="text" id="reg-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-email">Email:</label>
                        <input type="email" id="reg-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Heslo:</label>
                        <input type="password" id="reg-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-role">Rola:</label>
                        <select id="reg-role" class="form-control">
                            <option value="student">Študent</option>
                            <option value="teacher">Učiteľ</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%;">Registrovať sa</button>
                </form>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="main-dashboard" class="dashboard">
            <div class="header">
                <h1>Progresívne technológie - LMS</h1>
                <div class="user-info">
                    <span id="user-name">Užívateľ</span>
                    <span id="user-role" class="role-badge">Rola</span>
                    <button class="btn btn-secondary" onclick="logout()">Odhlásiť sa</button>
                </div>
            </div>

            <!-- Student Dashboard -->
            <div id="student-dashboard" class="dashboard">
                <div class="cards-grid">
                    <div class="card">
                        <h3>Moje štatistiky</h3>
                        <div class="stat-number" id="student-games-played">0</div>
                        <p>Odohratých hier</p>
                    </div>
                    <div class="card">
                        <h3>Priemerné skóre</h3>
                        <div class="stat-number" id="student-avg-score">0%</div>
                        <p>Zo všetkých hier</p>
                    </div>
                    <div class="card">
                        <h3>Najlepší výsledok</h3>
                        <div class="stat-number" id="student-best-score">0%</div>
                        <p>Najvyššie dosiahnuté skóre</p>
                    </div>
                </div>

                <div class="games-list">
                    <h3>Dostupné hry</h3>
                    <div class="game-item">
                        <div class="game-info">
                            <h4>Kvíz - Základné pojmy</h4>
                            <p>6 otázok o konvenčných a progresívnych technológiách</p>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="startGame('quiz')">Hrať</button>
                        </div>
                    </div>
                    <div class="game-item">
                        <div class="game-info">
                            <h4>Pexeso - Technológie</h4>
                            <p>Priraďte technológie k ich charakteristikám</p>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="startGame('memory')">Hrať</button>
                        </div>
                    </div>
                    <div class="game-item">
                        <div class="game-info">
                            <h4>Klasifikácia procesov</h4>
                            <p>Zatrieďte technológie do správnych kategórií</p>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="startGame('classification')">Hrať</button>
                        </div>
                    </div>
                    <div class="game-item">
                        <div class="game-info">
                            <h4>Energetická náročnosť</h4>
                            <p>Usporiadajte technológie podľa spotreby energie</p>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="startGame('sequence')">Hrať</button>
                        </div>
                    </div>
                </div>

                <div class="results-table">
                    <h3>Moje výsledky</h3>
                    <table id="student-results-table">
                        <thead>
                            <tr>
                                <th>Dátum</th>
                                <th>Hra</th>
                                <th>Skóre</th>
                                <th>Čas</th>
                                <th>Hodnotenie</th>
                            </tr>
                        </thead>
                        <tbody id="student-results-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Teacher Dashboard -->
            <div id="teacher-dashboard" class="dashboard">
                <div class="cards-grid">
                    <div class="card">
                        <h3>Registrovaní študenti</h3>
                        <div class="stat-number" id="total-students">0</div>
                        <p>Aktívnych účtov</p>
                    </div>
                    <div class="card">
                        <h3>Odohratých hier</h3>
                        <div class="stat-number" id="total-games">0</div>
                        <p>Celkový počet</p>
                    </div>
                    <div class="card">
                        <h3>Priemerná úspešnosť</h3>
                        <div class="stat-number" id="avg-success">0%</div>
                        <p>Zo všetkých študentov</p>
                    </div>
                </div>

                <div class="results-table">
                    <h3>Výsledky študentov</h3>
                    
                    <div class="filters">
                        <div class="filter-group">
                            <label>Študent:</label>
                            <select id="student-filter" onchange="filterResults()">
                                <option value="">Všetci študenti</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Hra:</label>
                            <select id="game-filter" onchange="filterResults()">
                                <option value="">Všetky hry</option>
                                <option value="quiz">Kvíz</option>
                                <option value="memory">Pexeso</option>
                                <option value="classification">Klasifikácia</option>
                                <option value="sequence">Seradenie</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Dátum od:</label>
                            <input type="date" id="date-filter" onchange="filterResults()">
                        </div>
                        <div class="filter-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-secondary" onclick="exportResults()">Export CSV</button>
                        </div>
                    </div>

                    <table id="teacher-results-table">
                        <thead>
                            <tr>
                                <th>Študent</th>
                                <th>Hra</th>
                                <th>Dátum</th>
                                <th>Skóre</th>
                                <th>Čas</th>
                                <th>Hodnotenie</th>
                                <th>Detaily</th>
                            </tr>
                        </thead>
                        <tbody id="teacher-results-tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Modal -->
    <div id="game-modal" class="game-modal">
        <div class="game-modal-content">
            <div class="game-modal-header">
                <h2 id="game-modal-title">Hra</h2>
                <button class="close-btn" onclick="closeGameModal()">×</button>
            </div>
            <div id="game-modal-content">
                <!-- Game content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Simulovaná databáza
        let database = {
            users: [
                {
                    id: 1,
                    name: "Ing. Peter Novák",
                    email: "teacher@vste.sk",
                    password: "heslo123",
                    role: "teacher"
                },
                {
                    id: 2,
                    name: "Ján Študent",
                    email: "student@vste.sk", 
                    password: "heslo123",
                    role: "student"
                }
            ],
            results: [
                {
                    id: 1,
                    studentId: 2,
                    studentName: "Ján Študent",
                    game: "quiz",
                    score: 83,
                    maxScore: 100,
                    time: 180,
                    date: new Date('2024-01-15').toISOString(),
                    details: "Správne odpovedané 5 z 6 otázok"
                }
            ]
        };

        let currentUser = null;
        let currentGame = null;

        // Game data
        const quizQuestions = [
            {
                question: "Ktoré z nasledujúcich patria medzi konvenčné procesy úberu materiálu?",
                options: [
                    "Rezanie a brúsenie",
                    "Elektrojiskrové obrábanie",
                    "Laserové obrábanie",
                    "Ultrazvukové obrábanie"
                ],
                correct: 0,
                explanation: "Konvenčné procesy využívajú mechanické zdroje energie - rezanie s definovanou geometriou reznej hrany a brúsenie s neurčenou geometriou britov."
            },
            {
                question: "Kedy boli vyvinuté nekonvenčné/progresívne procesy úberu materiálu?",
                options: [
                    "Pred rokom 1920",
                    "Po roku 1940",
                    "Po roku 1960",
                    "Po roku 1980"
                ],
                correct: 1,
                explanation: "Nekonvenčné procesy úberu materiálu boli vyvíjané až po roku 1940 ako odpoveď na potreby obrábania nových, ťažkoobrobiteľných materiálov."
            },
            {
                question: "Aká je hlavná výhoda progresívnych technológií oproti klasickým?",
                options: [
                    "Nižšia spotreba energie",
                    "Vyššia rýchlosť úberu",
                    "Úber nezávisí na mechanických vlastnostiach materiálu",
                    "Lacnejšie nástroje"
                ],
                correct: 2,
                explanation: "Progresívne technológie nezávisia na mechanických vlastnostiach materiálu (tvrdosť, pevnosť, houževnatosť), čo umožňuje obrábanie ťažkoobrobiteľných materiálov."
            },
            {
                question: "Ktoré tri základné podmienky musia byť splnené pre klasické obrábanie?",
                options: [
                    "Obrobiteľnosť, porušenie súdržnosti, konverzia energie",
                    "Rýchlosť, presnosť, kvalita",
                    "Teplota, tlak, vlhkosť",
                    "Sila, moment, výkon"
                ],
                correct: 0,
                explanation: "Základné podmienky pre klasické obrábanie: 1) obrobiteľnosť (nástroj tvrdší než obrobek), 2) porušenie súdržnosti materiálu, 3) konverzia na mechanickú energiu."
            },
            {
                question: "Ako veľké sú typicky mikro-triesky pri brúsení?",
                options: [
                    "Niekoľko mm²",
                    "Okolo tisíciny mm²",
                    "Niekoľko cm²",
                    "Okolo desatiny mm²"
                ],
                correct: 1,
                explanation: "Pri brúsení vznikajú veľmi malé mikro-triesky s prierezom rádovo okolo tisíciny mm², ktoré sú pouhým okom neviditeľné."
            },
            {
                question: "Aké energetické zdroje využívajú progresívne technológie?",
                options: [
                    "Iba mechanické",
                    "Iba elektrické",
                    "Fyzikálne, elektrické, chemické a iné",
                    "Iba tepelné"
                ],
                correct: 2,
                explanation: "Progresívne technológie využívajú rôzne zdroje energie: fyzikálne, elektrické, tepelné, chemické a elektrochemické - na rozdiel od konvenčných, ktoré používajú iba mechanickú energiu."
            }
        ];

        const memoryPairs = [
            { id: 1, text: "Rezanie", pair: "Definovaná geometria reznej hrany" },
            { id: 2, text: "Brúsenie", pair: "Neurčitá geometria britov" },
            { id: 3, text: "EDM", pair: "Elektrojiskrové obrábanie" },
            { id: 4, text: "LBM", pair: "Laserové obrábanie" },
            { id: 5, text: "Konvenčné", pair: "Mechanická energia" },
            { id: 6, text: "Progresívne", pair: "Rôzne zdroje energie" },
            { id: 7, text: "Mikro-triesky", pair: "~0.001 mm²" },
            { id: 8, text: "Po roku 1940", pair: "Vznik progresívnych technológií" }
        ];

        const classificationItems = [
            { name: "Sústruženie", type: "conventional" },
            { name: "Frézovanie", type: "conventional" },
            { name: "Vŕtanie", type: "conventional" },
            { name: "Brúsenie", type: "conventional" },
            { name: "Honovanie", type: "conventional" },
            { name: "Elektrojiskrové obrábanie", type: "progressive" },
            { name: "Laserové rezanie", type: "progressive" },
            { name: "Ultrazvukové obrábanie", type: "progressive" },
            { name: "Abrazívny vodný lúč", type: "progressive" },
            { name: "Elektrolytické brúsenie", type: "progressive" },
            { name: "Obrábanie elektrónovým lúčom", type: "progressive" },
            { name: "Chemické obrábanie", type: "progressive" }
        ];

        const sequenceItems = [
            { name: "LBM (Laserové obrábanie)", power: 2 },
            { name: "EBM (Elektrónový lúč)", power: 6 },
            { name: "AJM (Abrazívny prúd)", power: 4 },
            { name: "USM (Ultrazvukové)", power: 8 },
            { name: "EDM (Elektrojiskrové)", power: 10 },
            { name: "AWJ (Abrazívny vodný lúč)", power: 15 },
            { name: "KON (Konvenčné)", power: 18 }
        ];

        // Game variables
        let currentQuizQuestion = 0;
        let quizScore = 0;
        let gameStartTime = 0;
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let sequenceOrder = [];

        // Database functions
        function loadDatabase() {
            const saved = localStorage.getItem('progressiveTechDB');
            if (saved) {
                database = JSON.parse(saved);
            }
        }

        function saveDatabase() {
            localStorage.setItem('progressiveTechDB', JSON.stringify(database));
        }

        // Authentication functions
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="switchAuthTab('${tab}')"]`).classList.add('active');
            
            if (tab === 'login') {
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('hidden');
            } else {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
            }
        }

        function login(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const user = database.users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                showDashboard();
                showAlert('Úspešne prihlásený!', 'success');
            } else {
                showAlert('Nesprávne prihlasovacie údaje!', 'danger');
            }
        }

        function register(event) {
            event.preventDefault();
            
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const role = document.getElementById('reg-role').value;
            
            if (database.users.find(u => u.email === email)) {
                showAlert('Používateľ s týmto emailom už existuje!', 'danger');
                return;
            }
            
            const newUser = {
                id: database.users.length + 1,
                name,
                email,
                password,
                role
            };
            
            database.users.push(newUser);
            saveDatabase();
            
            currentUser = newUser;
            showDashboard();
            showAlert('Registrácia úspešná!', 'success');
        }

        function logout() {
            currentUser = null;
            document.getElementById('auth-section').style.display = 'block';
            document.getElementById('main-dashboard').classList.remove('active');
            localStorage.removeItem('currentUser');
        }

        // Dashboard functions
        function showDashboard() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-dashboard').classList.add('active');
            
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-role').textContent = currentUser.role === 'teacher' ? 'Učiteľ' : 'Študent';
            document.getElementById('user-role').className = currentUser.role === 'teacher' ? 'role-badge role-teacher' : 'role-badge role-student';
            
            if (currentUser.role === 'teacher') {
                showTeacherDashboard();
            } else {
                showStudentDashboard();
            }
        }

        function showStudentDashboard() {
            document.getElementById('teacher-dashboard').classList.remove('active');
            document.getElementById('student-dashboard').classList.add('active');
            
            updateStudentStats();
            loadStudentResults();
        }

        function showTeacherDashboard() {
            document.getElementById('student-dashboard').classList.remove('active');
            document.getElementById('teacher-dashboard').classList.add('active');
            
            updateTeacherStats();
            loadTeacherResults();
            populateStudentFilter();
        }

        function updateStudentStats() {
            const studentResults = database.results.filter(r => r.studentId === currentUser.id);
            
            document.getElementById('student-games-played').textContent = studentResults.length;
            
            if (studentResults.length > 0) {
                const avgScore = studentResults.reduce((sum, r) => sum + (r.score / r.maxScore * 100), 0) / studentResults.length;
                const bestScore = Math.max(...studentResults.map(r => r.score / r.maxScore * 100));
                
                document.getElementById('student-avg-score').textContent = Math.round(avgScore) + '%';
                document.getElementById('student-best-score').textContent = Math.round(bestScore) + '%';
            }
        }

        function updateTeacherStats() {
            const students = database.users.filter(u => u.role === 'student');
            const allResults = database.results;
            
            document.getElementById('total-students').textContent = students.length;
            document.getElementById('total-games').textContent = allResults.length;
            
            if (allResults.length > 0) {
                const avgSuccess = allResults.reduce((sum, r) => sum + (r.score / r.maxScore * 100), 0) / allResults.length;
                document.getElementById('avg-success').textContent = Math.round(avgSuccess) + '%';
            }
        }

        function loadStudentResults() {
            const tbody = document.getElementById('student-results-tbody');
            const studentResults = database.results
                .filter(r => r.studentId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            tbody.innerHTML = studentResults.map(result => {
                const percentage = Math.round((result.score / result.maxScore) * 100);
                const badgeClass = percentage >= 80 ? 'score-excellent' : percentage >= 60 ? 'score-good' : 'score-poor';
                const gameNames = {
                    quiz: 'Kvíz',
                    memory: 'Pexeso', 
                    classification: 'Klasifikácia',
                    sequence: 'Seradenie'
                };
                
                return `
                    <tr>
                        <td>${new Date(result.date).toLocaleDateString('sk-SK')}</td>
                        <td>${gameNames[result.game] || result.game}</td>
                        <td>${result.score}/${result.maxScore}</td>
                        <td>${formatTime(result.time)}</td>
                        <td><span class="score-badge ${badgeClass}">${percentage}%</span></td>
                    </tr>
                `;
            }).join('');
        }

        function loadTeacherResults() {
            const allResults = database.results.sort((a, b) => new Date(b.date) - new Date(a.date));
            displayResults(allResults);
        }

        function displayResults(results) {
            const tbody = document.getElementById('teacher-results-tbody');
            const gameNames = {
                quiz: 'Kvíz',
                memory: 'Pexeso',
                classification: 'Klasifikácia', 
                sequence: 'Seradenie'
            };
            
            tbody.innerHTML = results.map(result => {
                const percentage = Math.round((result.score / result.maxScore) * 100);
                const badgeClass = percentage >= 80 ? 'score-excellent' : percentage >= 60 ? 'score-good' : 'score-poor';
                
                return `
                    <tr>
                        <td>${result.studentName}</td>
                        <td>${gameNames[result.game] || result.game}</td>
                        <td>${new Date(result.date).toLocaleDateString('sk-SK')}</td>
                        <td>${result.score}/${result.maxScore}</td>
                        <td>${formatTime(result.time)}</td>
                        <td><span class="score-badge ${badgeClass}">${percentage}%</span></td>
                        <td>${result.details}</td>
                    </tr>
                `;
            }).join('');
        }

        function populateStudentFilter() {
            const select = document.getElementById('student-filter');
            const students = database.users.filter(u => u.role === 'student');
            
            select.innerHTML = '<option value="">Všetci študenti</option>' + 
                students.map(student => `<option value="${student.id}">${student.name}</option>`).join('');
        }

        function filterResults() {
            const studentFilter = document.getElementById('student-filter').value;
            const gameFilter = document.getElementById('game-filter').value;
            const dateFilter = document.getElementById('date-filter').value;
            
            let filteredResults = database.results;
            
            if (studentFilter) {
                filteredResults = filteredResults.filter(r => r.studentId == studentFilter);
            }
            
            if (gameFilter) {
                filteredResults = filteredResults.filter(r => r.game === gameFilter);
            }
            
            if (dateFilter) {
                filteredResults = filteredResults.filter(r => new Date(r.date) >= new Date(dateFilter));
            }
            
            displayResults(filteredResults);
        }

        function exportResults() {
            const results = database.results;
            const gameNames = {
                quiz: 'Kvíz',
                memory: 'Pexeso',
                classification: 'Klasifikácia',
                sequence: 'Seradenie'
            };
            
            let csv = 'Študent,Hra,Dátum,Skóre,Max Skóre,Percentá,Čas,Detaily\n';
            
            results.forEach(result => {
                const percentage = Math.round((result.score / result.maxScore) * 100);
                csv += `"${result.studentName}","${gameNames[result.game]}","${new Date(result.date).toLocaleDateString('sk-SK')}",${result.score},${result.maxScore},${percentage}%,"${formatTime(result.time)}","${result.details}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'vysledky_studentov.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Game functions
        function startGame(gameType) {
            if (currentUser.role !== 'student') return;
            
            currentGame = gameType;
            gameStartTime = Date.now();
            
            const gameNames = {
                quiz: 'Kvíz - Základné pojmy',
                memory: 'Pexeso - Technológie',
                classification: 'Klasifikácia procesov', 
                sequence: 'Energetická náročnosť'
            };
            
            document.getElementById('game-modal-title').textContent = gameNames[gameType];
            
            switch(gameType) {
                case 'quiz':
                    initQuiz();
                    break;
                case 'memory':
                    initMemoryGame();
                    break;
                case 'classification':
                    initClassificationGame();
                    break;
                case 'sequence':
                    initSequenceGame();
                    break;
            }
            
            document.getElementById('game-modal').style.display = 'block';
        }

        function closeGameModal() {
            document.getElementById('game-modal').style.display = 'none';
            currentGame = null;
        }

        function saveGameResult(gameType, score, maxScore, details) {
            const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
            
            const newResult = {
                id: database.results.length + 1,
                studentId: currentUser.id,
                studentName: currentUser.name,
                game: gameType,
                score: score,
                maxScore: maxScore,
                time: gameTime,
                date: new Date().toISOString(),
                details: details
            };
            
            database.results.push(newResult);
            saveDatabase();
            
            updateStudentStats();
            loadStudentResults();
            
            const percentage = Math.round((score / maxScore) * 100);
            showAlert(`Hra dokončená! Vaše skóre: ${score}/${maxScore} (${percentage}%)`, 'success');
        }

        // Quiz Game
        function initQuiz() {
            currentQuizQuestion = 0;
            quizScore = 0;
            showQuizQuestion();
        }

        function showQuizQuestion() {
            if (currentQuizQuestion >= quizQuestions.length) {
                showQuizResults();
                return;
            }

            const question = quizQuestions[currentQuizQuestion];
            const content = document.getElementById('game-modal-content');
            
            content.innerHTML = `
                <div class="question">
                    <h3>Otázka ${currentQuizQuestion + 1}/${quizQuestions.length}</h3>
                    <h3>${question.question}</h3>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option" onclick="selectQuizOption(${index})" data-index="${index}">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <button class="check-btn" onclick="checkQuizAnswer()" id="check-answer" style="display: none;">Skontrolovať</button>
                    <button class="next-btn" onclick="nextQuizQuestion()" id="next-question" style="display: none;">Ďalšia otázka</button>
                    <div id="explanation" style="display: none;"></div>
                </div>
            `;
        }

        function selectQuizOption(index) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-index="${index}"]`).classList.add('selected');
            document.getElementById('check-answer').style.display = 'inline-block';
        }

        function checkQuizAnswer() {
            const question = quizQuestions[currentQuizQuestion];
            const selectedOption = document.querySelector('.option.selected');
            const selectedIndex = parseInt(selectedOption.dataset.index);
            
            const options = document.querySelectorAll('.option');
            options.forEach((opt, index) => {
                if (index === question.correct) {
                    opt.classList.add('correct');
                } else if (index === selectedIndex && index !== question.correct) {
                    opt.classList.add('incorrect');
                }
            });

            if (selectedIndex === question.correct) {
                quizScore++;
            }

            document.getElementById('explanation').innerHTML = `
                <div class="explanation">
                    <h4>Vysvetlenie:</h4>
                    <p>${question.explanation}</p>
                </div>
            `;
            document.getElementById('explanation').style.display = 'block';
            document.getElementById('check-answer').style.display = 'none';
            document.getElementById('next-question').style.display = 'inline-block';
        }

        function nextQuizQuestion() {
            currentQuizQuestion++;
            showQuizQuestion();
        }

        function showQuizResults() {
            const content = document.getElementById('game-modal-content');
            const percentage = Math.round((quizScore / quizQuestions.length) * 100);
            
            content.innerHTML = `
                <div class="question">
                    <h3>Výsledky kvízu</h3>
                    <div class="game-score">
                        <h2>Získali ste ${quizScore} z ${quizQuestions.length} bodov (${percentage}%)</h2>
                        ${percentage >= 80 ? '🎉 Výborne!' : percentage >= 60 ? '👍 Dobre!' : '📚 Skúste to znova!'}
                    </div>
                    <button class="next-btn" onclick="finishQuiz()">Dokončiť</button>
                </div>
            `;
        }

        function finishQuiz() {
            const correct = quizScore;
            const total = quizQuestions.length;
            const details = `Správne odpovedané ${correct} z ${total} otázok`;
            
            saveGameResult('quiz', quizScore * 100 / quizQuestions.length, 100, details);
            closeGameModal();
        }

        // Memory Game
        function initMemoryGame() {
            memoryCards = [];
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            
            memoryPairs.forEach(pair => {
                memoryCards.push({ id: pair.id, text: pair.text, matched: false, flipped: false });
                memoryCards.push({ id: pair.id, text: pair.pair, matched: false, flipped: false });
            });
            
            memoryCards = memoryCards.sort(() => Math.random() - 0.5);
            renderMemoryGame();
        }

        function renderMemoryGame() {
            const content = document.getElementById('game-modal-content');
            
            content.innerHTML = `
                <div class="memory-stats">
                    <div>Tahy: <span id="memory-moves">${moves}</span></div>
                    <div>Páry: <span id="memory-pairs">${matchedPairs}/${memoryPairs.length}</span></div>
                </div>
                <div class="memory-grid" id="memory-grid">
                    ${memoryCards.map((card, index) => `
                        <div class="memory-card ${card.matched ? 'matched' : ''} ${card.flipped ? 'flipped' : ''}" 
                             onclick="flipMemoryCard(${index})" data-index="${index}">
                            <span>${card.flipped || card.matched ? card.text : '?'}</span>
                        </div>
                    `).join('')}
                </div>
                <button class="restart-btn" onclick="initMemoryGame()">🔄 Nová hra</button>
            `;
        }

        function flipMemoryCard(index) {
            if (flippedCards.length >= 2 || memoryCards[index].flipped || memoryCards[index].matched) return;
            
            memoryCards[index].flipped = true;
            flippedCards.push(index);
            renderMemoryGame();
            
            if (flippedCards.length === 2) {
                moves++;
                
                setTimeout(() => {
                    checkMemoryMatch();
                }, 1000);
            }
        }

        function checkMemoryMatch() {
            const [first, second] = flippedCards;
            
            if (memoryCards[first].id === memoryCards[second].id) {
                memoryCards[first].matched = true;
                memoryCards[second].matched = true;
                matchedPairs++;
                
                if (matchedPairs === memoryPairs.length) {
                    setTimeout(() => {
                        const details = `Všetky páry nájdené, ${moves} ťahov`;
                        saveGameResult('memory', 100, 100, details);
                        closeGameModal();
                    }, 500);
                }
            } else {
                memoryCards[first].flipped = false;
                memoryCards[second].flipped = false;
            }
            
            flippedCards = [];
            renderMemoryGame();
        }

        // Classification Game
        function initClassificationGame() {
            const content = document.getElementById('game-modal-content');
            const shuffledItems = [...classificationItems].sort(() => Math.random() - 0.5);
            
            content.innerHTML = `
                <div class="classification-container">
                    <div class="items-pool">
                        <h3>Technológie na zaradenie</h3>
                        <div id="items-container">
                            ${shuffledItems.map(item => `
                                <div class="draggable-item" draggable="true" ondragstart="dragClassification(event)" data-type="${item.type}">
                                    ${item.name}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <div class="drop-zone" id="conventional" ondrop="dropClassification(event, 'conventional')" ondragover="allowDropClassification(event)">
                            <h4>Konvenčné technológie</h4>
                            <div class="drop-items"></div>
                        </div>
                        <div class="drop-zone" id="progressive" ondrop="dropClassification(event, 'progressive')" ondragover="allowDropClassification(event)">
                            <h4>Progresívne technológie</h4>
                            <div class="drop-items"></div>
                        </div>
                    </div>
                </div>
                <button class="check-btn" onclick="checkClassification()">Skontrolovať odpovede</button>
                <button class="restart-btn" onclick="initClassificationGame()">🔄 Resetovať</button>
                <div id="classification-result"></div>
            `;
        }

        function allowDropClassification(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('drag-over');
        }

        function dragClassification(ev) {
            ev.dataTransfer.setData("text", ev.target.outerHTML);
            ev.dataTransfer.setData("type", ev.target.dataset.type);
            ev.target.classList.add('dragging');
        }

        function dropClassification(ev, category) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');
            
            const data = ev.dataTransfer.getData("text");
            ev.currentTarget.querySelector('.drop-items').innerHTML += data;
            
            const draggingElement = document.querySelector('.dragging');
            if (draggingElement) {
                draggingElement.remove();
            }
        }

        function checkClassification() {
            let correct = 0;
            let total = 0;
            
            const conventionalZone = document.getElementById('conventional').querySelector('.drop-items');
            const progressiveZone = document.getElementById('progressive').querySelector('.drop-items');
            
            conventionalZone.querySelectorAll('.draggable-item').forEach(item => {
                total++;
                if (item.dataset.type === 'conventional') {
                    correct++;
                    item.style.border = '2px solid #4caf50';
                } else {
                    item.style.border = '2px solid #f44336';
                }
            });
            
            progressiveZone.querySelectorAll('.draggable-item').forEach(item => {
                total++;
                if (item.dataset.type === 'progressive') {
                    correct++;
                    item.style.border = '2px solid #4caf50';
                } else {
                    item.style.border = '2px solid #f44336';
                }
            });
            
            const percentage = Math.round((correct / total) * 100);
            const details = `Správne zaradené ${correct} z ${total} technológií`;
            
            document.getElementById('classification-result').innerHTML = `
                <div class="game-score">
                    Správne zaradené: ${correct} z ${total} (${percentage}%)
                    ${percentage === 100 ? '🎉 Perfektné!' : percentage >= 80 ? '👍 Veľmi dobre!' : '📚 Skúste to znova!'}
                    <br><br>
                    <button class="check-btn" onclick="finishClassification(${correct}, ${total}, '${details}')">Dokončiť</button>
                </div>
            `;
        }

        function finishClassification(correct, total, details) {
            const score = Math.round((correct / total) * 100);
            saveGameResult('classification', score, 100, details);
            closeGameModal();
        }

        // Sequence Game
        function initSequenceGame() {
            sequenceOrder = [...sequenceItems].sort(() => Math.random() - 0.5);
            renderSequenceGame();
        }

        function renderSequenceGame() {
            const content = document.getElementById('game-modal-content');
            
            content.innerHTML = `
                <p>Usporiadajte technológie od najmenšej po najväčšiu spotrebu energie (kW)</p>
                <div style="display: grid; gap: 15px; max-width: 600px; margin: 20px auto;">
                    ${sequenceOrder.map((item, index) => `
                        <div class="draggable-item" style="cursor: move; display: flex; justify-content: space-between; align-items: center;">
                            <span>${item.name}</span>
                            <div>
                                <button onclick="moveSequenceUp(${index})" style="background: #2196F3; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; margin: 0 2px; cursor: pointer;">↑</button>
                                <button onclick="moveSequenceDown(${index})" style="background: #2196F3; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; margin: 0 2px; cursor: pointer;">↓</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <button class="check-btn" onclick="checkSequence()">Skontrolovať poradie</button>
                <button class="restart-btn" onclick="initSequenceGame()">