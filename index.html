<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>LMS - Progresivne technologie</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .header {
            background: #2196F3;
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            border-radius: 10px 10px 0 0;
            text-align: center;
        }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            min-height: 44px; /* Touch target pre mobile */
            -webkit-tap-highlight-color: transparent; /* Odstráni highlight na iOS */
            touch-action: manipulation; /* Rýchlejší touch */
        }
        .btn-blue { background: #2196F3; color: white; }
        .btn-green { background: #4CAF50; color: white; }
        .btn-red { background: #f44336; color: white; }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px; /* Predchádza zoom na iOS */
            -webkit-appearance: none; /* iOS styling */
        }
        
        .form-control:focus {
            border-color: #2196F3;
            outline: none;
        }
        
        select.form-control {
            height: 44px; /* Minimálna výška pre touch */
        }
        .hidden { display: none; }
        .games {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .game-card {
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .game-card:hover {
            border-color: #2196F3;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
        }
        .close {
            color: #999;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: black;
        }
        .question {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .option {
            display: block;
            margin: 8px 0;
            padding: 10px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }
        .option:hover {
            border-color: #2196F3;
        }
        .option.selected {
            border-color: #2196F3;
            background: #e3f2fd;
        }
        .option.correct {
            border-color: #4CAF50;
            background: #e8f5e8;
        }
        .option.wrong {
            border-color: #f44336;
            background: #ffebee;
        }
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 20px auto;
        }
        .memory-card {
            aspect-ratio: 1;
            background: #2196F3;
            color: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            text-align: center;
            padding: 5px;
        }
        .memory-card.flipped {
            background: white;
            color: #333;
            border: 2px solid #2196F3;
        }
        .memory-card.matched {
            background: #4CAF50;
            cursor: default;
        }
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 2000;
        }
        .alert-success { background: #4CAF50; }
        .alert-error { background: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LMS - Progresivne technologie</h1>
            <div id="user-info" class="hidden">
                <span id="current-user"></span>
                <button class="btn btn-red" onclick="logout()">Odhlasit</button>
            </div>
        </div>

        <!-- Prihlasenie a registracia -->
        <div id="auth-section">
            <!-- Taby -->
            <div style="display: flex; margin-bottom: 20px; background: #f0f0f0; border-radius: 5px; padding: 5px;">
                <button class="btn" id="login-tab" onclick="showTab('login')" style="flex: 1; background: #2196F3; color: white;">Prihlasenie</button>
                <button class="btn" id="register-tab" onclick="showTab('register')" style="flex: 1; background: transparent; color: #333;">Registracia</button>
            </div>

            <!-- Prihlasenie -->
            <div id="login-section">
                <h2>Prihlasenie</h2>
                <form onsubmit="prihlasit(); return false;">
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="login-email" class="form-control" value="student@test.sk" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label>Heslo:</label>
                        <input type="password" id="login-password" class="form-control" value="heslo123" autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-blue" style="width: 100%;">Prihlasit sa</button>
                </form>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 5px;">
                    <h4>Demo ucty:</h4>
                    <p><strong>Student:</strong> student@test.sk / heslo123</p>
                    <p><strong>Ucitel:</strong> teacher@test.sk / heslo123</p>
                    <hr style="margin: 15px 0;">
                    <p style="font-size: 12px; color: #666;">Ak mate problemy s prihlasenim:</p>
                    <button class="btn" onclick="resetData()" style="background: #ff9800; color: white; font-size: 12px; padding: 5px 10px;">Reset dat</button>
                </div>
            </div>

            <!-- Registracia -->
            <div id="register-section" class="hidden">
                <h2>Registracia</h2>
                <form onsubmit="registrovat(); return false;">
                    <div class="form-group">
                        <label>Meno a priezvisko:</label>
                        <input type="text" id="register-name" class="form-control" placeholder="Jan Novak" autocomplete="name">
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="register-email" class="form-control" placeholder="jan@example.com" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label>Heslo:</label>
                        <input type="password" id="register-password" class="form-control" placeholder="Minimalne 6 znakov" autocomplete="new-password">
                    </div>
                    <div class="form-group">
                        <label>Rola:</label>
                        <select id="register-role" class="form-control">
                            <option value="student">Student</option>
                            <option value="teacher">Ucitel</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-green" style="width: 100%;">Registrovat sa</button>
                </form>
            </div>
        </div>

        <!-- Student -->
        <div id="student-section" class="hidden">
            <h2>Student Dashboard</h2>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="student-games">0</div>
                    <div>Hier</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="student-avg">0%</div>
                    <div>Priemer</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="student-best">0%</div>
                    <div>Najlepsie</div>
                </div>
            </div>

            <h3>Hry</h3>
            <div class="games">
                <div class="game-card">
                    <h4>Quiz</h4>
                    <p>Test znalosti</p>
                    <button class="btn btn-blue" onclick="startGame('quiz')">Hrat</button>
                </div>
                <div class="game-card">
                    <h4>Pexeso</h4>
                    <p>Pary slov</p>
                    <button class="btn btn-blue" onclick="startGame('memory')">Hrat</button>
                </div>
                <div class="game-card">
                    <h4>Klasifikacia</h4>
                    <p>Rozdelenie</p>
                    <button class="btn btn-blue" onclick="startGame('classification')">Hrat</button>
                </div>
                <div class="game-card">
                    <h4>Poradie</h4>
                    <p>Usporiadanie</p>
                    <button class="btn btn-blue" onclick="startGame('sequence')">Hrat</button>
                </div>
            </div>

            <h3>Vysledky</h3>
            <table id="student-results">
                <thead>
                    <tr><th>Datum</th><th>Hra</th><th>Skore</th><th>Cas</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Ucitel -->
        <div id="teacher-section" class="hidden">
            <h2>Ucitel Dashboard</h2>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="total-students">1</div>
                    <div>Studenti</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="total-games">0</div>
                    <div>Hry</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="avg-score">0%</div>
                    <div>Uspesnost</div>
                </div>
            </div>

            <h3>Vsetky vysledky</h3>
            <button class="btn btn-green" onclick="exportCSV()">Export CSV</button>
            <table id="teacher-results">
                <thead>
                    <tr><th>Student</th><th>Hra</th><th>Datum</th><th>Skore</th><th>Cas</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Modal -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeGame()">&times;</span>
            <h2 id="game-title">Hra</h2>
            <div id="game-area"></div>
        </div>
    </div>

    <script>
        var users = {
            'student@test.sk': { password: 'heslo123', name: 'Jan Student', role: 'student' },
            'teacher@test.sk': { password: 'heslo123', name: 'Peter Ucitel', role: 'teacher' }
        };

        var currentUser = null;
        var results = [];
        var gameStartTime = 0;

        // Nacitanie dat
        function loadData() {
            var savedUsers = localStorage.getItem('lmsUsers');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
            }
            
            var savedResults = localStorage.getItem('lmsResults');
            if (savedResults) {
                results = JSON.parse(savedResults);
            }
        }

        function saveUsers() {
            localStorage.setItem('lmsUsers', JSON.stringify(users));
        }

        function saveData() {
            localStorage.setItem('lmsResults', JSON.stringify(results));
        }

        // Taby
        function showTab(tab) {
            if (tab === 'login') {
                document.getElementById('login-section').classList.remove('hidden');
                document.getElementById('register-section').classList.add('hidden');
                document.getElementById('login-tab').style.background = '#2196F3';
                document.getElementById('login-tab').style.color = 'white';
                document.getElementById('register-tab').style.background = 'transparent';
                document.getElementById('register-tab').style.color = '#333';
            } else {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('register-section').classList.remove('hidden');
                document.getElementById('register-tab').style.background = '#2196F3';
                document.getElementById('register-tab').style.color = 'white';
                document.getElementById('login-tab').style.background = 'transparent';
                document.getElementById('login-tab').style.color = '#333';
            }
        }

        // Registracia
        function registrovat() {
            var name = document.getElementById('register-name').value.trim();
            var email = document.getElementById('register-email').value.trim();
            var password = document.getElementById('register-password').value;
            var role = document.getElementById('register-role').value;
            
            // Validacia
            if (!name || !email || !password) {
                showAlert('Vyplnte vsetky polia!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showAlert('Heslo musi mat minimalne 6 znakov!', 'error');
                return;
            }
            
            if (users[email]) {
                showAlert('Pouzivatel s tymto emailom uz existuje!', 'error');
                return;
            }
            
            // Vytvorenie uctu
            users[email] = {
                name: name,
                password: password,
                role: role
            };
            
            saveUsers();
            showAlert('Registracia uspesna! Mozete sa prihlasit.', 'success');
            
            // Prepnutie na prihlasenie
            showTab('login');
            document.getElementById('login-email').value = email;
            document.getElementById('login-password').value = password;
        }

        // Prihlasenie
        function prihlasit() {
            var email = document.getElementById('login-email').value.trim();
            var password = document.getElementById('login-password').value.trim();
            
            // Debug - zkontrolujeme co mame ulozene
            console.log('Pokus o prihlasenie:', email);
            console.log('Dostupni pouzivatelia:', Object.keys(users));
            
            if (!email || !password) {
                showAlert('Vyplnte email a heslo!', 'error');
                return;
            }
            
            if (users[email] && users[email].password === password) {
                currentUser = { email: email, name: users[email].name, role: users[email].role };
                
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('user-info').classList.remove('hidden');
                document.getElementById('current-user').textContent = currentUser.name + ' (' + (currentUser.role === 'teacher' ? 'Ucitel' : 'Student') + ')';
                
                if (currentUser.role === 'student') {
                    document.getElementById('student-section').classList.remove('hidden');
                    updateStudentStats();
                    loadStudentResults();
                } else {
                    document.getElementById('teacher-section').classList.remove('hidden');
                    updateTeacherStats();
                    loadTeacherResults();
                }
                
                showAlert('Prihlasenie uspesne!', 'success');
            } else {
                showAlert('Nespravne udaje! Skontrolujte email a heslo.', 'error');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('student-section').classList.add('hidden');
            document.getElementById('teacher-section').classList.add('hidden');
            document.getElementById('user-info').classList.add('hidden');
            
            // Reset formularu a vymazanie vstupov
            showTab('login');
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('register-name').value = '';
            document.getElementById('register-email').value = '';
            document.getElementById('register-password').value = '';
            document.getElementById('register-role').value = 'student';
        }

        function showAlert(message, type) {
            var alert = document.createElement('div');
            alert.className = 'alert alert-' + type;
            alert.textContent = message;
            document.body.appendChild(alert);
            setTimeout(function() {
                if (document.body.contains(alert)) {
                    document.body.removeChild(alert);
                }
            }, 3000);
        }

        // Statistiky
        function updateStudentStats() {
            var studentResults = results.filter(function(r) { return r.email === currentUser.email; });
            document.getElementById('student-games').textContent = studentResults.length;
            
            if (studentResults.length > 0) {
                var total = 0;
                var best = 0;
                for (var i = 0; i < studentResults.length; i++) {
                    total += studentResults[i].score;
                    if (studentResults[i].score > best) best = studentResults[i].score;
                }
                var avg = Math.round(total / studentResults.length);
                document.getElementById('student-avg').textContent = avg + '%';
                document.getElementById('student-best').textContent = best + '%';
            }
        }

        function updateTeacherStats() {
            document.getElementById('total-games').textContent = results.length;
            
            if (results.length > 0) {
                var total = 0;
                for (var i = 0; i < results.length; i++) {
                    total += results[i].score;
                }
                var avg = Math.round(total / results.length);
                document.getElementById('avg-score').textContent = avg + '%';
            }
        }

        function loadStudentResults() {
            var tbody = document.querySelector('#student-results tbody');
            var studentResults = results.filter(function(r) { return r.email === currentUser.email; });
            
            tbody.innerHTML = '';
            for (var i = 0; i < studentResults.length; i++) {
                var r = studentResults[i];
                var row = tbody.insertRow();
                row.insertCell(0).textContent = new Date(r.date).toLocaleDateString();
                row.insertCell(1).textContent = r.game;
                row.insertCell(2).textContent = r.score + '%';
                row.insertCell(3).textContent = Math.floor(r.time/60) + ':' + (r.time%60).toString().padStart(2,'0');
            }
        }

        function loadTeacherResults() {
            var tbody = document.querySelector('#teacher-results tbody');
            tbody.innerHTML = '';
            
            for (var i = 0; i < results.length; i++) {
                var r = results[i];
                var row = tbody.insertRow();
                row.insertCell(0).textContent = r.name;
                row.insertCell(1).textContent = r.game;
                row.insertCell(2).textContent = new Date(r.date).toLocaleDateString();
                row.insertCell(3).textContent = r.score + '%';
                row.insertCell(4).textContent = Math.floor(r.time/60) + ':' + (r.time%60).toString().padStart(2,'0');
            }
        }

        // Hry
        function startGame(type) {
            gameStartTime = Date.now();
            document.getElementById('gameModal').style.display = 'block';
            
            var titles = {
                'quiz': 'Quiz - Progresivne technologie',
                'memory': 'Pexeso',
                'classification': 'Klasifikacia',
                'sequence': 'Usporiadanie'
            };
            
            document.getElementById('game-title').textContent = titles[type];
            
            if (type === 'quiz') startQuiz();
            else if (type === 'memory') startMemory();
            else if (type === 'classification') startClassification();
            else if (type === 'sequence') startSequence();
        }

        function closeGame() {
            document.getElementById('gameModal').style.display = 'none';
        }

        function saveResult(game, score, details) {
            var result = {
                email: currentUser.email,
                name: currentUser.name,
                game: game,
                score: score,
                time: Math.floor((Date.now() - gameStartTime) / 1000),
                date: new Date().toISOString(),
                details: details
            };
            
            results.push(result);
            saveData();
            
            updateStudentStats();
            loadStudentResults();
            updateTeacherStats();
            loadTeacherResults();
            
            showAlert('Hra skoncena! Skore: ' + score + '%', 'success');
        }

        // QUIZ
        var questions = [
            {
                q: "Ktore patria medzi konvencne procesy uberu materialu?",
                options: ["Rezanie a brusenie", "Elektrojiskrove obrabanie", "Laserove obrabanie", "Ultrazvukove obrabanie"],
                correct: 0
            },
            {
                q: "Kedy boli vyvinute progresivne procesy?",
                options: ["Pred 1920", "Po roku 1940", "Po roku 1960", "Po roku 1980"],
                correct: 1
            },
            {
                q: "Hlavna vyhoda progresivnych technologii?",
                options: ["Nizsia spotreba", "Vyssia rychlost", "Nezavislost na mechanickych vlastnostiach", "Lacnejsie nastroje"],
                correct: 2
            }
        ];

        var currentQuestion = 0;
        var correctAnswers = 0;

        function startQuiz() {
            currentQuestion = 0;
            correctAnswers = 0;
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestion >= questions.length) {
                var score = Math.round((correctAnswers / questions.length) * 100);
                document.getElementById('game-area').innerHTML = 
                    '<div style="text-align: center; padding: 30px;">' +
                    '<h2>Quiz dokonceny!</h2>' +
                    '<div style="font-size: 3em; color: #2196F3; margin: 20px 0;">' + score + '%</div>' +
                    '<p>Spravne: ' + correctAnswers + ' z ' + questions.length + '</p>' +
                    '<button class="btn btn-blue" onclick="finishQuiz(' + score + ')">Ulozit vysledok</button>' +
                    '</div>';
                return;
            }

            var q = questions[currentQuestion];
            var html = '<div class="question">' +
                '<h3>Otazka ' + (currentQuestion + 1) + '/' + questions.length + '</h3>' +
                '<p><strong>' + q.q + '</strong></p>';
            
            for (var i = 0; i < q.options.length; i++) {
                html += '<div class="option" onclick="selectAnswer(' + i + ')" data-index="' + i + '">' + q.options[i] + '</div>';
            }
            
            html += '<br><button class="btn btn-blue" onclick="checkAnswer()" id="checkBtn" style="display:none;">Skontrolovat</button>' +
                '<button class="btn btn-green" onclick="nextQuestion()" id="nextBtn" style="display:none;">Dalej</button>' +
                '</div>';
            
            document.getElementById('game-area').innerHTML = html;
        }

        function selectAnswer(index) {
            var options = document.querySelectorAll('.option');
            for (var i = 0; i < options.length; i++) {
                options[i].classList.remove('selected');
            }
            document.querySelector('[data-index="' + index + '"]').classList.add('selected');
            document.getElementById('checkBtn').style.display = 'inline-block';
        }

        function checkAnswer() {
            var selected = document.querySelector('.option.selected');
            var selectedIndex = parseInt(selected.dataset.index);
            var correct = questions[currentQuestion].correct;
            
            if (selectedIndex === correct) {
                correctAnswers++;
                selected.classList.add('correct');
            } else {
                selected.classList.add('wrong');
                document.querySelector('[data-index="' + correct + '"]').classList.add('correct');
            }
            
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            currentQuestion++;
            showQuestion();
        }

        function finishQuiz(score) {
            saveResult('Quiz', score, 'Spravne ' + correctAnswers + '/' + questions.length);
            closeGame();
        }

        // MEMORY
        var memoryPairs = [
            { text: "Rezanie", match: "Definovana geometria" },
            { text: "Brusenie", match: "Neurcita geometria" },
            { text: "EDM", match: "Elektrojiskrove" },
            { text: "LBM", match: "Laserove" }
        ];

        var memoryCards = [];
        var flippedCards = [];
        var matchedPairs = 0;

        function startMemory() {
            memoryCards = [];
            flippedCards = [];
            matchedPairs = 0;
            
            for (var i = 0; i < memoryPairs.length; i++) {
                memoryCards.push({ id: i, text: memoryPairs[i].text, flipped: false, matched: false });
                memoryCards.push({ id: i, text: memoryPairs[i].match, flipped: false, matched: false });
            }
            
            // Zamiesanie
            for (var i = memoryCards.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = memoryCards[i];
                memoryCards[i] = memoryCards[j];
                memoryCards[j] = temp;
            }
            
            renderMemory();
        }

        function renderMemory() {
            var html = '<div style="text-align: center; margin-bottom: 20px;">Najdene pary: ' + matchedPairs + '/' + memoryPairs.length + '</div>' +
                '<div class="memory-grid">';
            
            for (var i = 0; i < memoryCards.length; i++) {
                var card = memoryCards[i];
                var classes = 'memory-card';
                if (card.matched) classes += ' matched';
                if (card.flipped) classes += ' flipped';
                
                html += '<div class="' + classes + '" onclick="flipCard(' + i + ')">' +
                    (card.flipped || card.matched ? card.text : '?') + '</div>';
            }
            
            html += '</div>';
            
            if (matchedPairs === memoryPairs.length) {
                html += '<br><div style="text-align:center;"><button class="btn btn-blue" onclick="finishMemory()">Ulozit vysledok</button></div>';
            }
            
            document.getElementById('game-area').innerHTML = html;
        }

        function flipCard(index) {
            if (flippedCards.length >= 2 || memoryCards[index].flipped || memoryCards[index].matched) return;
            
            memoryCards[index].flipped = true;
            flippedCards.push(index);
            renderMemory();
            
            if (flippedCards.length === 2) {
                setTimeout(checkMemoryMatch, 1000);
            }
        }

        function checkMemoryMatch() {
            var first = flippedCards[0];
            var second = flippedCards[1];
            
            if (memoryCards[first].id === memoryCards[second].id) {
                memoryCards[first].matched = true;
                memoryCards[second].matched = true;
                matchedPairs++;
            } else {
                memoryCards[first].flipped = false;
                memoryCards[second].flipped = false;
            }
            
            flippedCards = [];
            renderMemory();
        }

        function finishMemory() {
            saveResult('Pexeso', 100, 'Vsetky pary najdene');
            closeGame();
        }

        // CLASSIFICATION
        var technologies = [
            { name: "Sustruzenie", type: "conventional" },
            { name: "Frezovanie", type: "conventional" },
            { name: "Brusenie", type: "conventional" },
            { name: "Elektrojiskrove", type: "progressive" },
            { name: "Laserove", type: "progressive" },
            { name: "Ultrazvukove", type: "progressive" }
        ];

        function startClassification() {
            var html = '<div style="margin-bottom: 20px;">Presunte technologie do spravnych kategorii:</div>';
            
            for (var i = 0; i < technologies.length; i++) {
                html += '<span style="display: inline-block; background: #2196F3; color: white; padding: 8px 15px; margin: 5px; border-radius: 15px; cursor: pointer;" onclick="toggleTech(this, \'' + technologies[i].type + '\')">' + 
                    technologies[i].name + '</span>';
            }
            
            html += '<div style="margin: 20px 0;"><h4>Konvencne:</h4><div id="conventional" style="min-height: 50px; border: 2px dashed #ddd; padding: 10px; margin: 10px 0;"></div></div>' +
                '<div style="margin: 20px 0;"><h4>Progresivne:</h4><div id="progressive" style="min-height: 50px; border: 2px dashed #ddd; padding: 10px; margin: 10px 0;"></div></div>' +
                '<div style="text-align: center;"><button class="btn btn-blue" onclick="checkClassification()">Skontrolovat</button></div>' +
                '<div id="classification-result"></div>';
            
            document.getElementById('game-area').innerHTML = html;
        }

        function toggleTech(element, type) {
            if (element.dataset.placed) {
                // Vratit naspat
                element.style.backgroundColor = '#2196F3';
                element.dataset.placed = '';
                element.onclick = function() { toggleTech(element, type); };
            } else {
                // Presunut do kategorie
                var category = type === 'conventional' ? 'conventional' : 'progressive';
                document.getElementById(category).appendChild(element);
                element.style.backgroundColor = '#757575';
                element.dataset.placed = category;
                element.dataset.originalType = type;
                element.onclick = function() { toggleTech(element, type); };
            }
        }

        function checkClassification() {
            var correct = 0;
            var total = 0;
            
            var convElements = document.getElementById('conventional').children;
            var progElements = document.getElementById('progressive').children;
            
            for (var i = 0; i < convElements.length; i++) {
                total++;
                if (convElements[i].dataset.originalType === 'conventional') {
                    correct++;
                    convElements[i].style.backgroundColor = '#4CAF50';
                } else {
                    convElements[i].style.backgroundColor = '#f44336';
                }
            }
            
            for (var i = 0; i < progElements.length; i++) {
                total++;
                if (progElements[i].dataset.originalType === 'progressive') {
                    correct++;
                    progElements[i].style.backgroundColor = '#4CAF50';
                } else {
                    progElements[i].style.backgroundColor = '#f44336';
                }
            }
            
            var score = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('classification-result').innerHTML = 
                '<div style="margin-top: 20px; text-align: center;">' +
                '<h3>Vysledok: ' + correct + '/' + total + ' (' + score + '%)</h3>' +
                '<button class="btn btn-blue" onclick="finishClassification(' + score + ', ' + correct + ', ' + total + ')">Ulozit vysledok</button>' +
                '</div>';
        }

        function finishClassification(score, correct, total) {
            saveResult('Klasifikacia', score, 'Spravne ' + correct + '/' + total);
            closeGame();
        }

        // SEQUENCE
        var energyData = [
            { name: "LBM (Laserove)", power: 2 },
            { name: "EBM (Elektronovy)", power: 6 },
            { name: "USM (Ultrazvukove)", power: 8 },
            { name: "EDM (Elektrojiskrove)", power: 10 },
            { name: "AWJ (Vodny luc)", power: 15 },
            { name: "KON (Konvencne)", power: 18 }
        ];

        var sequenceOrder = [];

        function startSequence() {
            sequenceOrder = energyData.slice();
            // Zamiesanie
            for (var i = sequenceOrder.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = sequenceOrder[i];
                sequenceOrder[i] = sequenceOrder[j];
                sequenceOrder[j] = temp;
            }
            renderSequence();
        }

        function renderSequence() {
            var html = '<p style="text-align: center; margin-bottom: 20px;">Usporiadajte technologie od najmenšej po najvačšiu spotrebu energie:</p>';
            
            for (var i = 0; i < sequenceOrder.length; i++) {
                html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #2196F3; color: white; margin: 10px 0; border-radius: 5px;">' +
                    '<span>' + sequenceOrder[i].name + '</span>' +
                    '<div>' +
                    '<button style="background: white; color: #2196F3; border: none; border-radius: 50%; width: 30px; height: 30px; margin: 0 2px; cursor: pointer;" onclick="moveUp(' + i + ')" ' + (i === 0 ? 'disabled' : '') + '>↑</button>' +
                    '<button style="background: white; color: #2196F3; border: none; border-radius: 50%; width: 30px; height: 30px; margin: 0 2px; cursor: pointer;" onclick="moveDown(' + i + ')" ' + (i === sequenceOrder.length - 1 ? 'disabled' : '') + '>↓</button>' +
                    '</div>' +
                    '</div>';
            }
            
            html += '<div style="text-align: center; margin-top: 20px;">' +
                '<button class="btn btn-blue" onclick="checkSequence()">Skontrolovat</button>' +
                '</div>' +
                '<div id="sequence-result"></div>';
            
            document.getElementById('game-area').innerHTML = html;
        }

        function moveUp(index) {
            if (index > 0) {
                var temp = sequenceOrder[index];
                sequenceOrder[index] = sequenceOrder[index - 1];
                sequenceOrder[index - 1] = temp;
                renderSequence();
            }
        }

        function moveDown(index) {
            if (index < sequenceOrder.length - 1) {
                var temp = sequenceOrder[index];
                sequenceOrder[index] = sequenceOrder[index + 1];
                sequenceOrder[index + 1] = temp;
                renderSequence();
            }
        }

        function checkSequence() {
            var correctOrder = energyData.slice().sort(function(a, b) { return a.power - b.power; });
            var correct = 0;
            
            for (var i = 0; i < sequenceOrder.length; i++) {
                if (sequenceOrder[i].name === correctOrder[i].name) {
                    correct++;
                }
            }
            
            var score = Math.round((correct / sequenceOrder.length) * 100);
            
            var html = '<div style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 5px;">' +
                '<h3>Vysledok: ' + correct + '/' + sequenceOrder.length + ' (' + score + '%)</h3>' +
                '<h4>Spravne poradie:</h4><ol>';
            
            for (var i = 0; i < correctOrder.length; i++) {
                html += '<li>' + correctOrder[i].name + ' (' + correctOrder[i].power + ' kW)</li>';
            }
            
            html += '</ol><div style="text-align: center; margin-top: 15px;">' +
                '<button class="btn btn-blue" onclick="finishSequence(' + score + ', ' + correct + ')">Ulozit vysledok</button>' +
                '</div></div>';
            
            document.getElementById('sequence-result').innerHTML = html;
        }

        function finishSequence(score, correct) {
            saveResult('Poradie', score, 'Spravne ' + correct + '/' + sequenceOrder.length);
            closeGame();
        }

        // Export CSV
        function exportCSV() {
            var csv = 'Student,Hra,Datum,Skore,Cas\n';
            for (var i = 0; i < results.length; i++) {
                var r = results[i];
                csv += '"' + r.name + '","' + r.game + '","' + new Date(r.date).toLocaleDateString() + '","' + r.score + '%","' + Math.floor(r.time/60) + ':' + (r.time%60).toString().padStart(2,'0') + '"\n';
            }
            
            var blob = new Blob([csv], { type: 'text/csv' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'vysledky.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Reset dat - pre pripad problemov
        function resetData() {
            if (confirm('Naozaj chcete vymazat vsetky ulozene data? Toto sa neda vratit spat.')) {
                localStorage.removeItem('lmsUsers');
                localStorage.removeItem('lmsResults');
                
                // Reset na default
                users = {
                    'student@test.sk': { password: 'heslo123', name: 'Jan Student', role: 'student' },
                    'teacher@test.sk': { password: 'heslo123', name: 'Peter Ucitel', role: 'teacher' }
                };
                results = [];
                
                saveUsers();
                saveData();
                
                showAlert('Data boli vymazane. Mozete sa prihlasit s demo uctami.', 'success');
                
                if (currentUser) {
                    logout();
                }
            }
        }

        // Inicializacia
        loadData();
        showTab('login'); // Zobrazit prihlasenie ako default
    </script>
</body>
</html>